<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: helpers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: helpers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { player, settings, world } from './globals.js'
import { openDebugMenu, openPauseMenu } from './menu.js'

/**
 * Shorthand for document.getElementById().
 * @param s - The ID of the element to locate.
 * @returns {HTMLElement} - The matching element.
 */
export function element (s) {
  return document.getElementById(s)
}

/**
 * Closes the window
 * @returns {Promise&lt;unknown>}
 */
export function quit () {
  window.close()
}

/**
 * Returns data for the given key from localStorage.
 * @param key - The name of requested key.
 * @returns {Promise&lt;unknown>} - A promise with the requested data.
 */
export async function fromStorage (key) {
  return JSON.parse(localStorage.getItem(key))
}

/**
 * Saves a given key-value pair to localStorage.
 * @param key - The name of the key to store the value as.
 * @param value - The value to store. If this is null or undefined, the record will be erased.
 * @returns {Promise&lt;unknown>} - Returns a promise if the data has been stored.
 */
export async function toStorage (key, value) {
  return localStorage.setItem(key, JSON.stringify(value))
}

/**
 * Receives the code of a mouse or key event and acts accordingly.
 * @param key - Can be 'KeyboardEvent.code' or 'Mouse + MouseEvent.button'.
 * @param down - Boolean of whether the event is up or down.
 */
export function handleMouseKeyEvent (key, down) {
  switch (key) {
    case settings.keybindings.attack:
      if (!world.paused) {
        if (down) player.controls.attack = (player.controls.attack === 2) ? 2 : true
        else player.controls.attack = false
      }
      break
    case settings.keybindings.down:
      if (!world.paused) player.controls.down = down
      break
    case settings.keybindings.left:
      if (!world.paused) player.controls.left = down
      break
    case settings.keybindings.right:
      if (!world.paused) player.controls.right = down
      break
    case settings.keybindings.jump:
      if (!world.paused) player.controls.jump = down
      break
    case 'Backquote':
      if (down) openDebugMenu()
      break
    case 'Escape':
      if (down) openPauseMenu()
      break
  }
}

/**
 * Converts a Unix timestamp with a given timezone into a simple h:mm number format.
 * @param timestamp - Unix timestamp in seconds.
 * @param timezone - Timezone difference from UTC in seconds.
 * @returns {number} - The given time as h:mm. (Example: 1300 for 1 PM)
 */
export function formatUnixTime (timestamp, timezone) {
  const date = new Date((timestamp + timezone) * 1000)
  return date.getUTCHours() * 100 + date.getUTCMinutes()
}

/**
 * Checks if the given entity is within the world border and moves it back if needed.
 * @param entity - The entity to check.
 */
export function borderControl (entity) {
  if (entity.frame.x > world.width) {
    entity.frame.x = world.width
  }
  if (entity.frame.x &lt; 0) {
    entity.frame.x = 0
  }
  if (entity.frame.y > world.height) {
    entity.frame.y = world.height
  }
  if (entity.frame.y &lt; 0) {
    entity.frame.y = 0
  }
}

export function collision (entity, object, isAttack) {
  if (entity.hasCollision &amp;&amp; (object.hasCollision || (Object.getPrototypeOf(Object.getPrototypeOf(object)).constructor.name === 'TileEntity' &amp;&amp; isAttack))) {
    const values = {
      up: entity.collision.up,
      down: entity.collision.down,
      left: entity.collision.left,
      right: entity.collision.right
    }
    if (!entity.collision.up) {
      entity.collision.up =
                entity.frame.x &lt; object.frame.x + object.frame.width &amp;&amp;
                entity.frame.x + entity.frame.width > object.frame.x &amp;&amp;
                entity.frame.y &lt; object.frame.y &amp;&amp;
                entity.frame.y + entity.frame.height >= object.frame.y &amp;&amp;
                object.hasCollision !== 2
      if (entity.collision.up &amp;&amp; (entity.frame.y + entity.frame.height - object.frame.y &lt;= 30) &amp;&amp; object.constructor.name === 'Tile') {
        entity.frame.y = object.frame.y - entity.frame.height
      }
    }
    if (!entity.collision.down) {
      entity.collision.down =
                entity.frame.x &lt; object.frame.x + object.frame.width &amp;&amp;
                entity.frame.x + entity.frame.width > object.frame.x &amp;&amp;
                entity.frame.y &lt;= object.frame.y + object.frame.height &amp;&amp;
                entity.frame.y > object.frame.y &amp;&amp;
                entity.frame.y + entity.frame.height > object.frame.y + object.frame.height
      if (object.hasCollision === 2 &amp;&amp; entity.controls.down) {
        entity.collision.down = false
      } else if (entity.collision.down &amp;&amp; (object.frame.y + object.frame.height - entity.frame.y &lt;= 30) &amp;&amp; object.constructor.name === 'Tile') {
        entity.frame.y = object.frame.y + object.frame.height
      }
    }
    if (!entity.collision.left) {
      entity.collision.left =
                entity.frame.x &lt;= object.frame.x + object.frame.width &amp;&amp;
                entity.frame.x + entity.frame.width > object.frame.x + object.frame.width &amp;&amp;
                entity.frame.y &lt; object.frame.y + object.frame.height &amp;&amp;
                entity.frame.y + entity.frame.height > object.frame.y &amp;&amp;
                object.hasCollision !== 2
      if (entity.collision.left &amp;&amp; (object.frame.x + object.frame.width - entity.frame.x &lt;= 20) &amp;&amp; object.constructor.name === 'Tile') {
        entity.frame.x = object.frame.x + object.frame.width
      }
    }
    if (!entity.collision.right) {
      entity.collision.right =
                entity.frame.x &lt; object.frame.x &amp;&amp;
                entity.frame.x + entity.frame.width >= object.frame.x &amp;&amp;
                entity.frame.y &lt; object.frame.y + object.frame.height &amp;&amp;
                entity.frame.y + entity.frame.height > object.frame.y &amp;&amp;
                object.hasCollision !== 2
      if (entity.collision.right &amp;&amp; (entity.frame.x + entity.frame.width - object.frame.x &lt;= 20) &amp;&amp; object.constructor.name === 'Tile') {
        entity.frame.x = object.frame.x - entity.frame.width
      }
    }
    if (
      entity.collision.left &amp;&amp; entity.collision.right &amp;&amp;
            entity.frame.x &lt;= object.frame.x &amp;&amp;
            entity.frame.x + entity.frame.width >= object.frame.x + object.frame.width &amp;&amp;
            !isAttack
    ) {
      entity.collision.left = false
      entity.collision.right = false
    }
    if (
      ((!values.up &amp;&amp; entity.collision.up) || (!values.down &amp;&amp; entity.collision.down) || (!values.left &amp;&amp; entity.collision.left) || (!values.right &amp;&amp; entity.collision.right)) &amp;&amp;
            ((entity.constructor.name !== 'Tile' &amp;&amp; object.constructor.name === 'Hero') || (entity.constructor.name === 'Hero' &amp;&amp; object.constructor.name !== 'Tile'))
    ) {
      return object
    } else return false
  } else return false
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#borderControl">borderControl</a></li><li><a href="global.html#element">element</a></li><li><a href="global.html#fonts">fonts</a></li><li><a href="global.html#formatUnixTime">formatUnixTime</a></li><li><a href="global.html#fromStorage">fromStorage</a></li><li><a href="global.html#geoCoderAPI">geoCoderAPI</a></li><li><a href="global.html#geoCoderModel">geoCoderModel</a></li><li><a href="global.html#handleMenuEvent">handleMenuEvent</a></li><li><a href="global.html#handleMouseKeyEvent">handleMouseKeyEvent</a></li><li><a href="global.html#LoadImage">LoadImage</a></li><li><a href="global.html#loadSettings">loadSettings</a></li><li><a href="global.html#menuAction">menuAction</a></li><li><a href="global.html#menus">menus</a></li><li><a href="global.html#navigate">navigate</a></li><li><a href="global.html#newDrawTile">newDrawTile</a></li><li><a href="global.html#oneCallAPI">oneCallAPI</a></li><li><a href="global.html#oneCallModel">oneCallModel</a></li><li><a href="global.html#openDebugMenu">openDebugMenu</a></li><li><a href="global.html#openPauseMenu">openPauseMenu</a></li><li><a href="global.html#quit">quit</a></li><li><a href="global.html#readStorage">readStorage</a></li><li><a href="global.html#saveSettings">saveSettings</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#setKey">setKey</a></li><li><a href="global.html#setupTray">setupTray</a></li><li><a href="global.html#toStorage">toStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Sat Sep 17 2022 23:35:29 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
