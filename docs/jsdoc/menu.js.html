<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: menu.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: menu.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { player, playerStats, settings, weather, world } from './globals.js'
import { element } from './helpers.js'
import { quit, toStorage } from './init.js'
import { geoCoderAPI, navigate } from './data.js'

/**
 * Contains the pause menus for ease of access.
 * @type {{new: HTMLElement, settingsApi: HTMLElement, load: HTMLElement, stats: HTMLElement, settingsGeneral: HTMLElement, pause: HTMLElement, settingsKeybindings: HTMLElement}}
 */
export const menus = {
  pause: element('pause'),
  new: element('new'),
  load: element('load'),
  stats: element('stats'),
  settingsGeneral: element('settingsGeneral'),
  settingsApi: element('settingsApi'),
  settingsKeybindings: element('settingsKeybindings')
}

/**
 * Handles a click event on an item in the pause menu that has a data-menu or data-action attribute.
 * @param target - The HTML element that was clicked.
 */
export function handleMenuEvent (target) {
  if (target.dataset.menu) {
    for (const menusKey in menus) {
      menus[menusKey].style.display = 'none'
    }
    menus[target.dataset.menu].style.display = 'flex'
  }
  if (target.dataset.action) {
    menuAction(target)
  }
}

/**
 * Handles a click event on an item that has a data-action attribute.
 * @param target - The HTML element that was clicked.
 */
function menuAction (target) {
  switch (target.dataset.action) {
    case 'continue':
      openPauseMenu()
      break
    case 'save':
      break
    case 'load':
      break
    case 'create':
      break
    case 'changeKey':
      target.addEventListener('keydown', setKey)
      target.addEventListener('mousedown', setKey)
      break
    case 'saveSettings':
      saveSettings()
      break
    case 'navigator':
      navigate()
      break
    case 'search':
      search(element('location').value, element('apiKey').value)
      break
    case 'selectResult':
      if (target.children.length !== 0) {
        const option = target.children[target.selectedIndex]
        element('lat').value = option.dataset.lat
        element('lon').value = option.dataset.lon
      }
      break
    case 'quit':
      toStorage('settings', settings).then(quit)
      break
  }
}

/**
 * Calls the geoCoderAPI and adds the results to the selector
 * @param location - The location to search for
 * @param apiKey - The API key
 */
function search (location, apiKey) {
  geoCoderAPI(location, apiKey).then(locations => {
    if (locations.length === 0) return
    element('searchResults').replaceChildren()
    for (const location of locations) {
      const option = document.createElement('option')
      option.textContent = `${location.name}, ${location.state} (${location.country})`
      option.dataset.lat = location.lat
      option.dataset.lon = location.lon
      element('searchResults').appendChild(option)
    }
  })
}

/**
 * Handler for the keybindings menu.
 * @param event - A keydown or mousedown event to rebind to a game action.
 */
function setKey (event) {
  event.target.removeEventListener('keydown', setKey)
  event.target.removeEventListener('mousedown', setKey)
  const key = event.code || `Mouse${event.button}`
  settings.keybindings[event.target.dataset.key] = key
  event.target.textContent = key
}

/**
 * Toggles the visibility of the pause menu and handles the associated values.
 */
export function openPauseMenu () {
  const pauseMenu = element('pauseMenu')
  if (pauseMenu.style.visibility === 'hidden') {
    world.paused = true
    pauseMenu.style.visibility = 'visible'
    loadSettings()
  } else {
    world.paused = element('debugMenu').style.visibility === 'visible'
    pauseMenu.style.visibility = 'hidden'
    saveSettings()
  }
}

/**
 * Saves most settings from the global settings to storage.
 */
function saveSettings () {
  // general
  settings.scale = parseFloat(element('scale').value)
  settings.showFPS = element('showFps').checked
  // api
  settings.api.key = element('apiKey').value
  settings.api.latitude = parseFloat(element('lat').value)
  settings.api.longitude = parseFloat(element('lon').value)
  settings.api.interval = parseInt(element('interval').value)
  // keybindings are saved automatically
  toStorage('settings', settings)
}

/**
 * Loads most settings from the global settings into the settings menu.
 */
function loadSettings () {
  // general
  element('scale').value = settings.scale
  element('showFps').checked = settings.showFPS
  // api
  element('apiKey').value = settings.api.key
  element('lat').value = settings.api.latitude
  element('lon').value = settings.api.longitude
  element('interval').value = settings.api.interval
  // keybindings
  const keys = element('keybindingsContainer')
  keys.replaceChildren()
  for (const key in settings.keybindings) {
    const div = document.createElement('div')
    const label = document.createElement('label')
    label.textContent = key
    div.appendChild(label)
    const button = document.createElement('button')
    button.dataset.action = 'changeKey'
    button.dataset.key = key
    button.textContent = settings.keybindings[key]
    div.appendChild(button)
    keys.appendChild(div)
  }
  // statistics
  element('nameStats').innerText = `Statistics (${player.name})`
  const stats = element('statsContainer')
  stats.replaceChildren()
  for (const playerStatsKey in playerStats) {
    const statItem = document.createElement('p')
    statItem.textContent = `${playerStatsKey}: ${playerStats[playerStatsKey]}`
    stats.appendChild(statItem)
  }
}

/**
 * Toggles the visibility of the debug menu and handles the associated data.
 */
export function openDebugMenu () {
  const debugMenu = element('debugMenu')
  if (debugMenu.style.visibility === 'hidden') {
    world.paused = true
    debugMenu.style.visibility = 'visible'
    // general
    element('showBoxes').checked = world.showBoxes
    element('showLiveDebug').checked = world.showLiveDebug
    element('showPlayerStats').checked = world.showPlayerStats
    // player
    element('hp').value = player.stats.hp
    element('maxHp').value = player.stats.maxHP
    element('mp').value = player.stats.mp
    element('maxMp').value = player.stats.maxMP
    element('xp').value = player.stats.xp
    element('damage').value = player.stats.damage
    element('speed').value = player.stats.speed
    element('maxAir').value = player.maxAir
    element('x').value = player.frame.x
    element('y').value = player.frame.y
    element('hasCollision').checked = player.hasCollision
    // weather
    for (const weatherKey in weather) {
      element(weatherKey).value = weather[weatherKey]
    }
  } else {
    world.paused = element('pauseMenu').style.visibility === 'visible'
    debugMenu.style.visibility = 'hidden'
    // general
    world.showBoxes = element('showBoxes').checked
    world.showLiveDebug = element('showLiveDebug').checked
    world.showPlayerStats = element('showPlayerStats').checked
    // player
    player.stats.hp = parseFloat(element('hp').value)
    player.stats.maxHP = parseFloat(element('maxHp').value)
    player.stats.mp = parseFloat(element('mp').value)
    player.stats.maxMP = parseFloat(element('maxMp').value)
    player.stats.xp = parseFloat(element('xp').value)
    player.stats.damage = parseFloat(element('damage').value)
    player.stats.speed = parseFloat(element('speed').value)
    player.maxAir = parseFloat(element('maxAir').value)
    player.frame.x = parseFloat(element('x').value)
    player.frame.y = parseFloat(element('y').value)
    player.hasCollision = element('hasCollision').checked
    // weather
    for (const weatherKey in weather) {
      const el = element(weatherKey).value
      if (!isNaN(parseFloat(el))) {
        weather[weatherKey] = parseFloat(el)
      } else {
        weather[weatherKey] = el
      }
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#borderControl">borderControl</a></li><li><a href="global.html#element">element</a></li><li><a href="global.html#fonts">fonts</a></li><li><a href="global.html#formatUnixTime">formatUnixTime</a></li><li><a href="global.html#fromStorage">fromStorage</a></li><li><a href="global.html#geoCoderAPI">geoCoderAPI</a></li><li><a href="global.html#geoCoderModel">geoCoderModel</a></li><li><a href="global.html#handleMenuEvent">handleMenuEvent</a></li><li><a href="global.html#handleMouseKeyEvent">handleMouseKeyEvent</a></li><li><a href="global.html#LoadImage">LoadImage</a></li><li><a href="global.html#loadSettings">loadSettings</a></li><li><a href="global.html#menuAction">menuAction</a></li><li><a href="global.html#menus">menus</a></li><li><a href="global.html#navigate">navigate</a></li><li><a href="global.html#newDrawTile">newDrawTile</a></li><li><a href="global.html#oneCallAPI">oneCallAPI</a></li><li><a href="global.html#oneCallModel">oneCallModel</a></li><li><a href="global.html#openDebugMenu">openDebugMenu</a></li><li><a href="global.html#openPauseMenu">openPauseMenu</a></li><li><a href="global.html#quit">quit</a></li><li><a href="global.html#readStorage">readStorage</a></li><li><a href="global.html#saveSettings">saveSettings</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#setKey">setKey</a></li><li><a href="global.html#setupTray">setupTray</a></li><li><a href="global.html#toStorage">toStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Sat Sep 17 2022 23:35:29 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
